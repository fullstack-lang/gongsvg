<div>Width: {{ svgWidth}}</div>
<div>Height: {{ svgHeight }}</div>
<svg [attr.width]="svgWidth" [attr.height]="svgHeight" >
    <g>
        <ng-container *ngFor="let layer of svg.Layers" class="child">
            <ng-container *ngFor="let circle of layer.Circles">
                <circle class="overlay" 
                    [attr.cx]="circle.CX" 
                    [attr.cy]="circle.CY" 
                    [attr.r]="circle.Radius" 
                    [attr.fill]="circle.Color!" 
                    [attr.fill-opacity]="circle.FillOpacity"
                    [attr.stroke]="circle.Stroke" 
                    [attr.stroke-width]="circle.StrokeWidth" 
                    [attr.stroke-dasharray]="circle.StrokeDashArray"
                    [attr.transform]="circle.Transform">
    
                <animate *ngFor="let animate of circle.Animations" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </circle>
            </ng-container>
            <ng-container *ngFor="let ellipse of layer.Ellipses">
                <ellipse 
                    [attr.rx]="ellipse.RX"
                    [attr.ry]="ellipse.RY"
                    [attr.cx]="ellipse.CX"
                    [attr.cy]="ellipse.CY"
                    [attr.fill]="ellipse.Color"
                    [attr.fill-opacity]="ellipse.FillOpacity"
                    [attr.stroke]="ellipse.Stroke"
                    [attr.stroke-width]="ellipse.StrokeWidth"
                    [attr.stroke-dasharray]="ellipse.StrokeDashArray" />

                <animate *ngFor="let animate of ellipse.Animates" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </ng-container>
            <ng-container *ngFor="let line of layer.Lines">
                <line 
                    [attr.x1]="line.X1"
                    [attr.y1]="line.Y1"
                    [attr.x2]="line.X2"
                    [attr.y2]="line.Y2"
                    [attr.fill]="line.Color"
                    [attr.fill-opacity]="line.FillOpacity"
                    [attr.stroke]="line.Stroke"
                    [attr.stroke-width]="line.StrokeWidth"
                    [attr.stroke-dasharray]="line.StrokeDashArray"
                    [attr.transform]="line.Transform" />
                <animate *ngFor="let animate of line.Animates" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </ng-container>
            <ng-container *ngFor="let path of layer.Paths">
                <path [attr.d]="path.Definition"
                    [attr.fill]="path.Color"
                    [attr.fill-opacity]="path.FillOpacity"
                    [attr.stroke]="path.Stroke"
                    [attr.stroke-width]="path.StrokeWidth"
                    [attr.stroke-dasharray]="path.StrokeDashArray"/>
    
                <animate *ngFor="let animate of path.Animates" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </ng-container>
            <ng-container *ngFor="let polygone of layer.Polygones">
                <polygon 
                    [attr.points]="polygone.Points"
                    [attr.fill]="polygone.Color"
                    [attr.fill-opacity]="polygone.FillOpacity"
                    [attr.stroke]="polygone.Stroke"
                    [attr.stroke-width]="polygone.StrokeWidth"
                    [attr.stroke-dasharray]="polygone.StrokeDashArray" />
    
                <animate *ngFor="let animate of polygone.Animates" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </ng-container>
            <ng-container *ngFor="let polyline of layer.Polylines">
                <polyline [attr.points]="polyline.Points"
                    [attr.fill]="polyline.Color"
                    [attr.fill-opacity]="polyline.FillOpacity"
                    [attr.stroke]="polyline.Stroke"
                    [attr.stroke-width]="polyline.StrokeWidth"
                    [attr.stroke-dasharray]="polyline.StrokeDashArray"
                />
    
                <animate *ngFor="let animate of polyline.Animates" 
                    [attr.attributeName]="animate.AttributeName" 
                    [attr.values]="animate.Values" 
                    [attr.dur]="animate.Dur" 
                    [attr.repeatCount]="animate.RepeatCount" />
            </ng-container>
            <ng-container *ngFor="let rect of layer.Rects">
                <rect   
                    [attr.x]="rect.X"
                    [attr.y]="rect.Y"
                    [attr.width]="rect.Width"
                    [attr.height]="rect.Height"
                    [attr.rx]="rect.RX"
                    [attr.fill]="rect.Color"
                    [attr.fill-opacity]="rect.FillOpacity"
                    [attr.stroke]="rect.Stroke"
                    [attr.stroke-width]="rect.StrokeWidth"
                    [attr.stroke-dasharray]="rect.IsSelected ? rect.StrokeDashArrayWhenSelected : rect.StrokeDashArray"
                    [attr.transform]="rect.Transform"

                    (mousedown)="rectMouseDown($event, rect)"
                    (mousemove)="rectMouseMove($event, rect)"
                    (mouseup)="rectMouseUp($event, rect)">

            <animate
                    *ngFor="let animate of rect.Animations"
                    [attr.attributeName]="animate.AttributeName"
                    [attr.values]="animate.Values"
                    [attr.dur]="animate.Dur"
                    [attr.repeatCount]="animate.RepeatCount" />

        </rect>
            </ng-container>
        </ng-container>
    </g>
</svg>

<ng-template #anchoredText let-text="text" let-anchorX="anchorX" let-anchorY="anchorY">
    <ng-container *ngIf='splitTextIntoLines(text.Content) as lines'>
            <svg:text class="anchored-text"
            [attr.x]="anchorX" 
            [attr.y]="anchorY" 
            [attr.fill]="text.Color"    
            [attr.fill-opacity]="text.FillOpacity"
            [attr.stroke]="text.Stroke"
            [attr.stroke-width]="text.StrokeWidth != 0 ? text.StrokeWidth : null"
            [attr.stroke-dasharray]="text.StrokeDashArray"
            [attr.transform]="text.Transform"
            [attr.text-anchor]="text.TextAnchorType"
            [attr.font-weight]="text.FontWeight"
            [attr.font-size]="text.FontSize !== 0 ? text.FontSize + 'px' : null"
            >
            <tspan *ngFor='let line of lines; let j = index' 
                    [attr.x]="anchorX"
                    [attr.dy]="j > 0 ? '1em' : '0'"
                    [attr.text-anchor]="text.TextAnchorType">{{line}}</tspan>  
            </text>
    </ng-container>
</ng-template>

<ng-template #anchoredRect let-rect="rect" let-anchorX="anchorX" let-anchorY="anchorY" let-width="width">
    <svg:rect   
    class="anchored-rect"
    [attr.x]="anchorX"
    [attr.y]="anchorY"
    [attr.width]="width"
    [attr.height]="rect.Height"
    [attr.rx]="rect.RX"
    [attr.fill]="rect.Color"
    [attr.fill-opacity]="rect.FillOpacity"
    [attr.stroke]="rect.Stroke"
    [attr.stroke-width]="rect.StrokeWidth"
    > </rect>
</ng-template>